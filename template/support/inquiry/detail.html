{% set title = "Conacoin.io | 실시간 고객센터" %}
{% set pageName = "supportPage" %}
{% extends "layout/base.html" %}

{% block content %}
    {% include("layout/subvisual.html") %}

    <section class="sec support-inquiry-isec comm-pd">
        <div class="inquiry-wrapper">
            <div class="inquiry-content group">
                <div class="inquiry-title comm-title">
                    <h1 class="title">
                        실시간 문의하기
                    </h1>
                </div>
                <div class="tbl-comm-st">※ 답변이 완료된 문의는 이메일로 답변이 전송되오니 확인 부탁드립니다.</div>
                <table class="detail-tbl">
                    <tbody>
                        <tr>
                            <td>
                                <p class="row">
                                    <span class="label name">이름</span><span class="text name">{{ inquiry.name }}</span></p>
                                <p class="row">
                                    <span class="label">이메일</span><span class="text email">{{ inquiry.email }}</span></p>
                                {% if inquiry.reply_cnt %}
                                    <span class="status active">
                                        답변완료
                                    </span>
                                {% else %}
                                    <span class="status">
                                        답변대기
                                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr class="title">
                            <td>
                                <p class="row">
                                    <span class="label title">제목</span><span class="text title">{{ inquiry.title }}</span></p>
                            </td>
                        </tr>
                        <tr class="content">
                            <td>
                                <p class="text content">{{ inquiry.content }}</p>
                                <div class="reply-register-wrapper">
                                    <ul class="tablist">
                                        {% if inquiry.Reply.length %}
                                            <li class="tab">
                                                <a href="javascript:;" class="tab-btn" id="register_edit">댓글 수정</a>
                                            </li>
                                            <li class="tab">
                                                <a href="/support/inquiry/reply/delete/{{ inquiry.id }}" class="tab-btn" id="register_delete">댓글 삭제</a>
                                            </li>
                                        {% else %}
                                            <li class="tab">
                                                <a href="javascript:;" class="tab-btn" id="register_write">
                                                    댓글 쓰기
                                                    <span class="arr down"></span>
                                                    <span class="arr up"></span>
                                                </a>
                                            </li>
                                        {% endif %}
                                    </ul>
                                    {% if inquiry.Reply.length %}
                                        <form action="/support//inquiry/reply/edit/{{ inquiry.id }}" method="post">
                                            <div class="reply-form cf" id="reply_form">
                                                <textarea class="form-textarea register-content" name="content" required="required"></textarea>
                                                <button type="submit" id="register_btn" class="register-btn">수정</button>
                                            </div>
                                        </form>
                                    {% else %}
                                        <form action="" method="post">
                                            <div class="reply-form cf" id="reply_form">
                                                <textarea class="form-textarea register-content" name="content" required="required"></textarea>
                                                <button type="submit" id="register_btn" class="register-btn">등록</button>
                                            </div>
                                        </form>
                                    {% endif %}

                                </div>
                            </td>
                        </tr>

                        {% for reply in inquiry.Reply %}
                            <tr class="reply" id="reply_wrapper">
                                <td>
                                    <div>
                                        <p class="label reply-name">고객센터</p>
                                        <p class="text reply-content">{{ reply.content }}</p>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="inquiry-actions">
                    <a href="javascript: history.back(-1)" class="comm-btn outline back-btn">이전</a>
                    <a href="/support/inquiry/delete/{{ inquiry.id }}" class="comm-btn outline delete-btn">삭제</a>
                </div>
            </div>
        </div>
    </section>
    <!-- /.sec support-inquiry-sec -->

    {% include("inc/bn_meet.html") %}
    {% include("inc/support_pw_pop.html") %}

    <script>
        $('#sp_submit').on('click', function () {
            var data_id = {{ inquiry.content }};
            var $sp_pw_input = $('#sp_pw_input');
            if (!$sp_pw_input.val()) {
                alert('비밀번호를 입력하세요.');
                $sp_pw_input.focus();
                return false;
            }
            if ($sp_pw_input.val().length < 4) {
                alert('네글자 이상 입력하세요.');
                $sp_pw_input.focus();
                return false;
            }
            $
                .ajax({
                    url: '/support/password',
                    type: 'post',
                    data: {
                        inquiry_id: data_id,
                        sp_password: $sp_pw_input
                            .val()
                            .trim()
                    }
                })
                .done(function (result) {
                    if (result.status.length) {
                        location.href = "/support/";
                    }
                })
                .fail(function (result) {
                    console.log(result);
                    alert('비밀번호 오류');
                })
        });
        $('#register_write').on('click', function () {
            $(this).toggleClass('active');
            $('#reply_form').toggleClass('active');
        });
        $('#register_edit').on('click', function () {
            $(this).toggleClass('active');
            $('#reply_wrapper').toggle();
            $('#reply_form').toggle();
        });
    </script>
{% endblock %}