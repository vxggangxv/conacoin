{% set pageName = 'adminSiteimgPage' %}
{% set titleLength = 300 %}
{% extends "admin/layout/base.html" %}

{% block content %}
<section class="sec admin-siteimg-sec">
    <h1 class="comm-sec-title sec-title">이미지 등록</h1>
    <div class="wrapper-group cf">
        <div class="wrapper-type1 comm-card card-sm edit-wrapper">
            <div class="content-type1">
                <div class="comm-title">
                    <h2 class="title">오픈 배너 이미지 등록 <span class="st">(<span class="c-primary">10MB 이하</span>, 권장 사이트 400 x 450)</span></h2>
                </div>
                <table class="tbl-type1 edit-tbl">
                    <colgroup>
                        <col style="width: 100%">
                    </colgroup>
                    <tbody>
                        {% for item in openbanners %}
                        <tr class="bor-no upload-row">
                            <td>
                                <span class="no">No 1. </span>
                                <span class="label">링크: </span>
                                <input class="form-input label-text" readonly name="date" type="text" maxlength="{{ titleLength }}" required="required" value="{{ item.link }}">
                                <span class="label img">이미지: </span>

                                <span class="file-name label-text">{{ item.filename }}</span>
                                <div class="fileform-wrapper pd-md hide">
                                    <input type="file" class="fileform" name="openbannerFiles_1" id="openbannerFiles_1" data-file-size="10">
                                    <label for="openbannerFiles_1">파일선택</label>
                                    <span class="filename">선택된 파일 없음</span>
                                </div>


                                <span class="btn-cover">
                                    <a href="javascript:;" class="btn btn-primary edit-one-btn pull-right" onclick="editToggleOn(this)">수정</a>
                                    <a href="javascript:;" class="btn btn-primary edit-one-btn pull-right hide" onclick="editOne(this)">적용</a>
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                        <!-- {% if openbanners.length %}
                        <div class="img-list-wrapper">
                            <div class="img-title">
                                <p class="img-name">
                                    {{ openbanners.length }}개 이미지
                                </p>
                            </div>
                            <div class="img-list-scroll">
                                <ul class="img-list">
                                    {% for item in openbanners %}
                                    <li class="img-item"><span class="txt">{{ item.filename }}</span> <a href="/conaservice/siteimg/openbanners/delete/{{ item.id }}" class="close-btn"><i class="mdi mdi-close-box-outline"></i></a></li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        {% endif %} -->
                    </tbody>
                </table>
                <div class="comm-actions">
                    <!-- <a href="javascript:;" class="comm-btn primary register-btn" id="openbannersEditBtn">등록</a> -->
                    <a href="javascript:;" class="comm-btn primary register-btn" id="openbannersAddBtn">추가</a>
                    {% if openbanners.length %}
                    <a href="javascript:;" class="comm-btn outline delete-btn pull-right" id="openbannersDeleteBtn">전체 삭제</a>
                    {% endif %}
                </div>
                </form>
            </div>
        </div>
    </div>
</section>
<script>
    function editToggleOn(obj) {
        $(obj).addClass('hide').siblings().removeClass('hide');
        $(obj).closest('td').find('.form-input').attr('readonly', false);
        $(obj).closest('td').find('.file-name').addClass('hide');
        $(obj).closest('td').find('.fileform-wrapper').removeClass('hide');
        $(obj).closest('td').find('.form-input:first-of-type').focus();
    }

    function editOne(obj) {
        var files = $(obj).closest('input[type=file]')[0].files;
        if (!files.length) {
            alert('파일을 등록하세요.')
            return false;
        }
        data = new FormData();
        for (var i = 0; i < files.length; i++) {
            data.append("file", files[i]);
        }
        $('#ldsMask').show();
        $.ajax({
            data: {
                data
            },
            type: "post",
            url: '/conaservice/siteimg/openbanners/edit',
            cache: false,
            contentType: false,
            processData: false,
            success: function (result) {
                // alert('이미지가 등록되었습니다.')
                $('#ldsMask').hide();
                location.reload();
            },
            fail: function (error) {
                console.log(error);
                alert('오류 발생');
            }
        });
        $(obj).addClass('hide').siblings().removeClass('hide');
    }
    $('#editOneBtn').on('click', function () {
        $(this).show().siblings().hide();
    });
    // 오픈배너
    var openbannerFiles = [];
    $('input[name=openbannerFiles]').on('change', function () {
        openbannerFiles = this.files;
        // console.log(openbannerFiles);
    })
    $('#openbannersEditBtn').on('click', function () {
        // var openbannerFiles = $('input[name=file]#openbannerFiles')[0].files;
        if (!openbannerFiles.length) {
            alert('파일을 등록하세요.')
            return false;
        }
        data = new FormData();
        for (var i = 0; i < openbannerFiles.length; i++) {
            data.append("file", openbannerFiles[i]);
        }
        $('#ldsMask').show();
        $.ajax({
            data: data,
            type: "post",
            url: '/conaservice/siteimg/openbanners/edit',
            cache: false,
            contentType: false,
            processData: false,
            success: function (result) {
                // alert('이미지가 등록되었습니다.')
                $('#ldsMask').hide();
                location.reload();
            },
            fail: function (error) {
                console.log(error);
                alert('오류 발생');
            }
        });
    });
    $('#openbannersAddBtn').on('click', function () {
        if (!openbannerFiles.length) {
            alert('파일을 등록하세요.')
            return false;
        }
        data = new FormData();
        for (var i = 0; i < openbannerFiles.length; i++) {
            data.append("file", openbannerFiles[i]);
        }
        $('#ldsMask').show();
        $.ajax({
            data: data,
            type: "post",
            url: '/conaservice/siteimg/openbanners/add',
            cache: false,
            contentType: false,
            processData: false,
            success: function (result) {
                // alert('이미지가 등록되었습니다.')
                $('#ldsMask').hide();
                location.reload();
            },
            fail: function (error) {
                console.log(error);
                alert('오류 발생');
            }
        });
    });
    $('#openbannersDeleteBtn').on('click', function () {
        if (!confirm('정말로 삭제하시겠습니까?')) {
            return false;
        }
        $('#ldsMask').show();
        $.ajax({
            type: "get",
            url: '/conaservice/siteimg/openbanners/delete/all',
            success: function (result) {
                // alert('이미지가 삭제되었습니다.')
                $('#ldsMask').hide();
                location.reload();
            },
            fail: function (error) {
                console.log(error);
                alert('오류 발생');
            }
        });
    });
    // 파트너사
    var partnerbannerFiles = [];
    $('input[name=partnerbannerFiles]').on('change', function () {
        partnerbannerFiles = this.files;
        // console.log(partnerbannerFiles);
    })
    $('#partnerbannersEditBtn').on('click', function () {
        // var partnerbannerFiles = $('input[name=file]#partnerbannerFiles')[0].files;
        if (!partnerbannerFiles.length) {
            alert('파일을 등록하세요.')
            return false;
        }
        data = new FormData();
        for (var i = 0; i < partnerbannerFiles.length; i++) {
            data.append("file", partnerbannerFiles[i]);
        }
        $('#ldsMask').show();
        $.ajax({
            data: data,
            type: "post",
            url: '/conaservice/siteimg/partnerbanners/edit',
            cache: false,
            contentType: false,
            processData: false,
            success: function (result) {
                // alert('이미지가 등록되었습니다.')
                $('#ldsMask').hide();
                location.reload();
            },
            fail: function (error) {
                console.log(error);
                alert('오류 발생');
            }
        });
    });
    $('#partnerbannersAddBtn').on('click', function () {
        if (!partnerbannerFiles.length) {
            alert('파일을 등록하세요.')
            return false;
        }
        data = new FormData();
        for (var i = 0; i < partnerbannerFiles.length; i++) {
            data.append("file", partnerbannerFiles[i]);
        }
        $('#ldsMask').show();
        $.ajax({
            data: data,
            type: "post",
            url: '/conaservice/siteimg/partnerbanners/add',
            cache: false,
            contentType: false,
            processData: false,
            success: function (result) {
                // alert('이미지가 등록되었습니다.')
                $('#ldsMask').hide();
                location.reload();
            },
            fail: function (error) {
                console.log(error);
                alert('오류 발생');
            }
        });
    });
    $('#partnerbannersDeleteBtn').on('click', function () {
        if (!confirm('정말로 삭제하시겠습니까?')) {
            return false;
        }
        $('#ldsMask').show();
        $.ajax({
            type: "get",
            url: '/conaservice/siteimg/partnerbanners/delete/all',
            success: function (result) {
                // alert('이미지가 삭제되었습니다.')
                $('#ldsMask').hide();
                location.reload();
            },
            fail: function (error) {
                console.log(error);
                alert('오류 발생');
            }
        });
    });
</script>
{% endblock %}